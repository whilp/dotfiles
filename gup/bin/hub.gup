#!/bin/sh
set -ex

sum=4096b95aea46f674e91ff0d83f86d876958024a02c50ffb1e3a4aac3e0536fc5
url=https://github.com/github/hub/archive/v2.3.0-pre10.tar.gz

ext=$PWD/../ext/$2
gup -u $ext/Dockerfile

t=$(mktemp -d)
trap "rm -rf $t" EXIT

(
cd $t
get-and-check "$url" "tgz" "$sum"
mkdir src out
tar xzf tgz --strip-components=1 -C src
cp -r $ext/* src/.
docker build -t hub:build src
docker run --rm hub:build sh -c 'cd /go/bin && tar -c hub' | tar -xv -C out
cp out/hub "$1"
chmod a+x "$1"
)

