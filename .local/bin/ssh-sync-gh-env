#!/usr/bin/env luajit

-- Collect GH environment variables
local function collect_gh_env_vars()
  local gh_vars = {
    "GH_TOKEN",
    "GITHUB_TOKEN",
    "GH_ENTERPRISE_TOKEN",
    "GITHUB_ENTERPRISE_TOKEN",
    "GH_HOST",
    "GH_REPO",
    "GH_EDITOR",
    "GH_BROWSER",
    "GH_DEBUG",
    "GH_PAGER",
  }

  local env = {}
  for _, var in ipairs(gh_vars) do
    local value = os.getenv(var)
    if value then
      env[var] = value
    end
  end

  return env
end

-- Generate env.lua content (flat table with string keys/values)
local function generate_env_lua(env)
  local parts = {
    "-- GitHub CLI environment configuration",
    "-- Auto-generated by ssh-sync-gh-env",
    "",
    "return {",
  }

  for key, value in pairs(env) do
    table.insert(parts, string.format("  %s = %q,", key, value))
  end

  table.insert(parts, "}")

  return table.concat(parts, "\n")
end

-- Main
local env = collect_gh_env_vars()

-- If no GH vars are set, exit
if next(env) == nil then
  os.exit(0)
end

local env_lua_content = generate_env_lua(env)
io.write(env_lua_content)
