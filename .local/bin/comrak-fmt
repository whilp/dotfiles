#!/usr/bin/env luajit

-- Build comrak command with arguments
local args = {"comrak", "--to", "commonmark", "--gfm", "--width", "0", "--front-matter-delimiter", "---"}
for i = 1, #arg do
    table.insert(args, arg[i])
end

-- Run comrak and capture output
local handle = io.popen(table.concat(args, " "))
local output = handle:read("*a")
local success, exit_type, exit_code = handle:close()

if not success then
    os.exit(exit_code or 1)
end

-- Fix space after triple backticks with language info
output = output:gsub("^``` (.+)", "```%1"):gsub("\n``` (.+)", "\n```%1")

-- Write to stdout
io.write(output)
